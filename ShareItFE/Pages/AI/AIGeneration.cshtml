@page
@model ShareItFE.Pages.AI.AIGeneration
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment Environment
@{
    ViewData["Title"] = "AIGeneration";
    var accessToken = HttpContextAccessor.HttpContext?.Request.Cookies["AccessToken"] ?? "";
    var productId = HttpContextAccessor.HttpContext?.Request.Query["ProductId"].ToString() ?? "";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FashionFit - Virtual Try-On Experience</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="~/css/style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1 class="app-title">Try On Fashion<span class="sparkle">Fit</span></h1>

        </header>

        <div class="upload-section">
            <div class="upload-box">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2><i class="fas fa-user-circle"></i> Person Image</h2>
                    <button type="button" id="clearPersonBtn" class="clear-image-btn" style="display: none;">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
                <div class="dropzone" id="personDropzone">
                    <i class="fas fa-cloud-upload-alt cloud-icon"></i>
                    <div class="upload-text">
                        <p>Drop Image Here</p>
                        <p>- or -</p>
                        <p class="upload-link">Click to Upload</p>
                    </div>
                    <input type="file" id="personInput" accept="image/*">
                </div>
                
                <!-- Example Images Section -->
                <div class="example-images-section" style="margin-top: 15px;">
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                        <i class="fas fa-images"></i> Or choose an example:
                    </p>
                    <div class="example-images-container">
                        <img src="https://res.cloudinary.com/ddw4fhvpq/image/upload/v1762479740/handsome-african-american-male-fashion-model-full-length-portrait-posing-isolated-white-background-46340658_jwufxo.webp" 
                             class="example-image" alt="Example 1" data-example="1">
                        <img src="https://res.cloudinary.com/ddw4fhvpq/image/upload/v1762479739/806ad2f5e12a0aa8657fa81b22349014_jh25rs.jpg" 
                             class="example-image" alt="Example 2" data-example="2">
                        <img src="https://res.cloudinary.com/ddw4fhvpq/image/upload/v1762479542/20250820083203_5d47fbb82a154caa8f2d8b2320f4f2ba_m2l3n3.jpg" 
                             class="example-image" alt="Example 3" data-example="3">
                        <img src="https://res.cloudinary.com/ddw4fhvpq/image/upload/v1762479542/6a0d486d92469e77185680afb1ff8e6c_ziveat.jpg" 
                             class="example-image" alt="Example 4" data-example="4">
                    </div>
                </div>
            </div>

            <div class="upload-box">
                <h2><i class="fas fa-tshirt"></i> Garment Image</h2>
                <div class="dropzone garment-readonly" id="garmentDropzone" style="cursor: default; pointer-events: none;">
                    <i class="fas fa-tshirt cloud-icon"></i>
                    <div class="upload-text">
                        <p>No garment selected</p>
                        <p style="font-size: 0.85em; color: #999;">Go to a product page and click "Try On"</p>
                    </div>
                </div>
                <div id="garmentThumbnails" class="garment-thumbnails"
                    style="display: flex; gap: 8px; margin-top: 10px;"></div>
                <div id="garmentSelectContainer" style="margin-top: 10px; display: none;">
                    <label for="garmentSelect" style="font-weight: bold; margin-bottom: 5px; display: block;">Select
                        Garment Image:</label>
                    <select id="garmentSelect" class="cloth-type-dropdown"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Choose a garment image...</option>
                    </select>
                </div>
            </div>

            <div class="upload-box">
                <label for="clothTypeSelector" style="font-weight: bold; margin-bottom: 5px;">Clothing Type</label>
                <select id="clothTypeSelector" class="cloth-type-dropdown">
                    <option value="upper">Upper (e.g. shirt)</option>
                    <option value="lower">Lower (e.g. pants)</option>
                    <option value="overall">Overall (e.g. jumpsuit)</option>
                </select>
            </div>

            <div style="display: flex; justify-content: center; align-items: center; margin: 30px 0; width: 100%;">
                <button class="generate-button" id="generateButton" type="button" disabled>
                    <i class="fas fa-wand-magic-sparkles"></i> Create Magic!
                </button>
            </div>
        </div>

        <div class="results-section">
            <div class="results-box">
                <h2><i class="fas fa-tshirt"></i> Your Fashion Preview</h2>
                <div class="generated-image-container" id="generatedImageContainer">
                    <div class="image-placeholder">
                        <i class="fas fa-camera placeholder-icon"></i>
                        <p>Your virtual try-on image will appear here</p>
                    </div>
                    <button class="regenerate-feedback-button" id="regenerateFeedbackButton" type="button"
                            style="margin-top: 15px; display: none;">
                        <i class="fas fa-redo"></i> Regenerate the analysis
                    </button>
                </div>

                <div class="analysis-box" id="analysisBox">
                    <div class="analysis-header">
                        <i class="fas fa-crown"></i>
                        <span>Style Fairy Analysis</span>
                    </div>
                    <div class="analysis-content">
                        Generate a try-on image to see AI style and fit analysis
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            &copy; 2025 FashionFit - Virtual Try-On Technology
        </footer>
    </div>

    <script>
        // API Settings for saving Try-On images to gallery
        window.apiSettings = {
            baseUrl: '@(Configuration[$"ApiSettings:{Environment.EnvironmentName}:BaseUrl"] ?? "https://localhost:7256/api")',
            accessToken: '@accessToken',
            productId: '@productId' || null
        };
    </script>
    <script src="~/js/Ai/index.js"></script>
    
    <style>
        .clear-image-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .clear-image-btn:hover {
            background-color: #cc0000;
            transform: scale(1.05);
        }
        
        .clear-image-btn i {
            font-size: 0.9em;
        }
        
        .example-images-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .example-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .example-image:hover {
            border-color: #FF6B98;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 107, 152, 0.3);
        }
        
        .example-image.selected {
            border-color: #FF6B98;
            border-width: 3px;
            box-shadow: 0 0 0 3px rgba(255, 107, 152, 0.2);
        }
        
        @@media (max-width: 768px) {
            .example-images-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</body>

</html>